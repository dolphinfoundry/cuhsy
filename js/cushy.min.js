jQuery(function(e){var t=!1,n=t?"dev.cushy.com":"cushy.com",i="https://"+n,a=e(document),s=a.find("input#pluginPath").val(),c=1,d=!1,o=[];e(document).find(".cushy-preview").remove(),a.addClass("cushy-media-modal media-modal"),a.find("a#add-cushy-button").html('<img src="'+s+'/assets/cushy-logo.png" alt="add cushy" style="width:18px; margin-top: -4px;" />Add cushy'),e.fn.calculateAspectRatioFit=function(e,t,n,i){var a=Math.min(n/e,i/t);return{width:e*a,height:t*a}},a.on("click","#settingsSaveBtn",function(){console.log(i);var t=e.trim(e("#username").val()),n=e.trim(e("#sec_key").val());return 0==t.length?(e("#username").next(".field-error").text("Please enter Username"),!1):0==n.length?(e("#sec_key").next(".field-error").text("Please enter Security Key"),!1):void e.ajax({url:i+"/sections/auth.php",data:{username:t},beforeSend:function(){e("#settingsSaveBtn").attr("disabled",!0)},dataType:"jsonp",success:function(t){return e("#settingsSaveBtn").attr("disabled",!1),void 0!==t.success&&1==t.success?(e("#form").submit(),!0):(e("#username").focus(),void e("#error").text("Sorry!!! Username does not match"))},error:function(){alert("Error")}})}),e.fn.has_scrollbar=function(){var e=this.get(0);return e.scrollHeight>e.clientHeight?!0:void 0},e.fn.fetchCushyList=function(t,n){setTimeout(function(){if(0==d){d=!0;var s=e.trim(e(document).find("#user_name").val()),c=e.trim(e(document).find("#sec_key").val()),o=e.trim(e(document).find("#media-search-input").val());e("#TB_window").addClass("cushyTBWindow"),""!==s&&""!==c?e.ajax({method:"POST",url:i+"/api/v1/get_user_feeds",data:{user_name:s,security_key:c,page:t,search_key:o},beforeSend:function(){o.length>0||void 0!==n?e.fn.searchFieldActions(!0):e(".pre-loader").show()},dataType:"jsonp",success:function(t){if(e.fn.searchFieldActions(!1),d=!1,e(".pre-loader").hide(),e("button#loadMoreBtn").text("Load more"),1==t.success&&void 0!==t.data.records&&t.data.records.length>0){var i="";if((o.length>0||void 0!==n)&&e("#TB_window").find(".render-cushy-list").find("li").not("li.pre-loader-content").remove(),e.each(t.data.records,function(e,t){console.info(t),t.hasOwnProperty("media_large")&&t.hasOwnProperty("media_thumb")&&(i='<li tabindex="0" role="checkbox" aria-label="'+e+'" data-id="'+t.cushy_code+'" class="attachment save-ready select-item is-def-ite"><div class="attachment-preview js--select-attachment type-image subtype-png landscape"><div class="thumbnail cushy-lazy-bg" rel="'+t.cushy_code+'"><div class="centered"><img class="thumb-img" src="'+t.media_thumb.url+'" draggable="false" alt="N/A"></div></div></div><button type="button" class="button-link check" tabindex="0"><span class="media-modal-icon"></span><span class="screen-reader-text">Deselect</span></button><input type="hidden" id="cushy_id'+t.cushy_code+'" name="cushy_id[]" value="'+t.cushy_code+'"><input type="hidden" id="cushy_view_url'+t.cushy_code+'" name="cushy_view_url[]" value="'+t.view_url+'"><input type="hidden" id="cushy_media'+t.cushy_code+'" name="cushy_media[]" value="'+t.media_large.url+'"><input type="hidden" id="cushy_desc'+t.cushy_code+'" name="cushy_desc[]" value="'+t.description+'"><input type="hidden" id="cushy_loc'+t.cushy_code+'" name="cushy_loc[]" value="'+t.location_name+'"><input type="hidden" id="cushy_date'+t.cushy_code+'" name="cushy_date[]" value="'+t.cushy_time+'"><input type="hidden" id="cushy_tags'+t.cushy_code+'" name="cushy_tags[]" value="'+t.tags+'"><input type="hidden" id="cushy_img_data'+t.cushy_code+'" name="cushy_img_data[]" value="'+t.media_large.width+"x"+t.media_large.height+'">',a.find("#TB_window").find(".render-cushy-list").append(i))}),a.find("#TB_window").find(".render-cushy-list").find("img.thumb-img").load(function(){this.style.opacity=1}),void 0!==t.data.next&&t.data.next>0&&t.data.records.length>=20){var s='<li class="btn-load-wrap"><button type="button" id="loadMoreBtn" class="btn btn-md btn-core-btn">Load more</button></li>';e("#TB_window").find(".render-cushy-list").append(s)}}else void 0!==t.message&&""!==t.message?e("#TB_window").find(".render-cushy-list").html('<li class="error-holder">'+t.message+"</li>"):void 0!=t.data.records&&0==t.data.records.length&&e("#TB_window").find(".render-cushy-list").html('<li class="error-holder">No matching cushys</li>'),a.find(".clear-selection").trigger("click")},error:function(){console.log("Error fetching data")}}):console.log("Cushy credentials are missing")}},500)},e("#add-cushy-button").on("click",function(){c=1,o=[],u="",e.fn.fetchCushyList(c)});var r=!1;a.on("keyup click",".cushy-search-input",function(t){var n=e.trim(e(this).val());clearTimeout(e.data(this,"timer")),c=1,"keyup"==t.type&&(n.length>2||0===n.length)&&(r=!0,e(this).data("timer",setTimeout(function(){e.fn.fetchCushyList(c,r)},200))),"click"==t.type&&n.length>0&&r&&(r=!1,e(this).data("timer",setTimeout(function(){e.fn.fetchCushyList(c,r)},200)))}),a.on("click",".search-close-icon",function(t){a.find(".cushy-search-input").val(""),c=1,e.fn.fetchCushyList(c,!1)}),e.fn.searchFieldActions=function(e){e?a.find(".search-fld-btn").addClass("search-load-icon").removeClass("search-close-icon"):a.find(".cushy-search-input").val().length>0?a.find(".search-fld-btn").addClass("search-close-icon").removeClass("search-load-icon"):a.find(".search-fld-btn").removeClass("search-load-icon search-close-icon")},a.on("click","button#loadMoreBtn",function(t){e(this).attr("disabled",!0).text("Loading..."),c++,e(".btn-load-wrap").fadeOut(),e.fn.fetchCushyList(c)});var l=!1,u="";a.on("click","li.select-item",function(t){l=t.ctrlKey||t.metaKey?!0:!1;var n=e(this).attr("data-id"),i=e.inArray(n,o);i>=0?o.splice(i,1):5===o.length?alert("You can select upto 5 Cushy's"):o.push(n),a.find("li.select-item").removeClass("selected details"),o.length>0&&e.each(o,function(t,n){e("[data-id='"+n+"']").addClass("selected")}),e(this).addClass("details");var s=o.length;if(s>0){var c=e(this).find(".thumbnail").attr("src"),c=e("#cushy_media"+n).val(),d=e("#cushy_desc"+n).val(),r=e("#cushy_loc"+n).val(),u=e("#cushy_date"+n).val();a.find(".cushy-overview").show(),a.find(".attachment-info .thumbnail-image img").attr("src",c),e("input.cushy-media").val(c),e("textarea.cushy-caption").val(d.replace(/\\/g,"")),e("input.cushy-loc").val(r.replace(/\\/g,"")),e("input.cushy-date").val(u);var h=e("#cushy_tags"+n).val();""!==h?e(".tags-block").css("display","block").find(".cushy-tags").html(h):e(".tags-block").css("display","none").find(".cushy-tags").html(""),a.find(".return-btn").is(":visible")||e(".media-selection").show(),e(".media-selection").find(".count").text(s+" selected"),a.find(".media-button-insert").attr("disabled",!1)}else e(".media-selection").hide(),a.find(".media-button-insert").attr("disabled",!0)}),a.on("click",".edit-selection",function(){a.find(".select-item").not(".selected").hide(),a.find(".media-selection, button#loadMoreBtn").hide(),a.find(".return-btn").show()}),a.on("click",".clear-selection",function(){o=[],a.find(".select-item").removeClass("selected details"),a.find(".media-button-insert").attr("disabled",!0),e(".media-selection, .cushy-overview").hide()}),a.on("click",".return-btn",function(){e(this).hide(),a.find(".select-item, .media-selection, button#loadMoreBtn").show()}),e(document).on("click",".thumbnail",function(){e("body").removeClass("active-cushy"),e(this).addClass("active-cushy")}),e.fn.removeIframeMargin=function(){setTimeout(function(){var t=e("#content_ifr").contents().find("head");t.append(e("<link/>",{rel:"stylesheet",href:s+"/css/cushy-override.css",type:"text/css"}))},1)};e(document).on("click",".media-button-insert",function(){return o.length>0?(e(this).attr("disabled",!1),e.each(o,function(t,n){var i=e("#cushy_img_data"+n).val();u+='<div class="cushy-card" style="display: none">[cushyview caption="'+e("#cushy_desc"+n).val()+'" id="'+n+'" img_data="'+i+'"]\n</div>';var a=i.split("x"),s=320,c=480;void 0!==a&&void 0!==a[0]&&a[0]>a[1]&&(s=480,c=320);var d='[cushy_card caption="'+e("#cushy_desc"+n).val()+'" id="'+n+'" img_data="'+i+'"]';wp.media.editor.insert(d)}),o=[],e.fn.removeIframeMargin(),void 0):(e(this).attr("disabled",!0),!1)}),e(document).on("click",".media-modal-close",function(){c=1,o=[],u="",a.find(".select-item").removeClass("selected details"),a.find("#TB_window").fadeOut(),a.find("#TB_overlay").css({background:"transparent",opacity:1})}),"undefined"!=typeof tinyMCE&&(null==tinyMCE.activeEditor||0!=tinyMCE.activeEditor.isHidden())&&(e.fn.tinyMcePluginParser=function(){tinymce.PluginManager.add("cushy_card",function(t,n){function a(e,t){return t=new RegExp(t+'="([^"]+)"',"g").exec(e),t?window.decodeURIComponent(t[1]):""}function c(t,n,c){var d=a(n,"id"),o=a(n,"img_data"),r=o.split("x"),l=0,u=0;if(void 0!==r&&void 0!==r[0]){imgWidth=r[0],imgHeight=r[1];var h=e(window).width()<1440?75*e(document).find(".mce-edit-area").innerWidth()/100:e(document).find(".mce-edit-area").innerWidth();return u=imgHeight/imgWidth*h,u=Math.round(u),h>imgWidth?(l=imgWidth,u=imgHeight):l=h,n=window.encodeURIComponent(n),content=window.encodeURIComponent(c),e(document).find(".mce-preview-object").css("display","none"),'<iframe src="'+i+"/sections/view/"+d+'" width="'+l+'" height="'+u+'" class="mceItem '+t+'" data-sh-attr="'+n+'" data-sh-content="'+c+'" frameborder="0" style="width: '+l+"px; height: "+u+"px; max-width: "+l+"px; max-height: "+u+"px; background: #D8D8D8 url("+s+'/assets/loader.png) no-repeat center center;"></iframe>'}}function d(e){return e.replace(/\[cushy_card([^\]]*)\]/g,function(e,t,n){return c("wp-"+r,t,n)})}function o(e){return e.replace(/(<iframe.*?>.*?<\/iframe>)/g,function(e,t){var n=a(t,"data-sh-attr");a(t,"data-sh-content");return n?"<p>["+r+n+"]</p>":e})}var r="cushy_card";t.on("BeforeSetcontent",function(e){e.content=d(e.content)}),t.on("GetContent",function(e){e.content=o(e.content)}),e.fn.removeIframeMargin()})},e.fn.tinyMcePluginParser())});