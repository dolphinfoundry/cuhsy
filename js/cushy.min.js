jQuery(function(e){var t=!0,i=t?"192.168.0.105/cushy_dev":"dev.cushy.com",a="http://"+i,s=e(document),n=s.find("input#pluginPath").val(),d=1,c=!1,o=[];s.addClass("cushy-media-modal media-modal"),s.find("a#add-cushy-button").html('<img src="'+n+'/cushy-logo.png" alt="add cushy" style="width:18px; margin-top: -4px;" />Add Cushy'),s.on("click","#test",function(){var t=e("#username").val();return t?void e.ajax({url:a+"/sections/auth.php",data:{username:t},dataType:"jsonp",success:function(t){return console.info(t),void 0!==t.success&&1==t.success?(e("#form").submit(),!0):(e("#username").focus(),void e("#error").text("User name error"))},error:function(){alert("Error")}}):(alert("Please enter username"),!1)}),e.fn.has_scrollbar=function(){var e=this.get(0);return e.scrollHeight>e.clientHeight?!0:void 0},e.fn.fetchCushyList=function(t){setTimeout(function(){if(0==c){c=!0;var i=e.trim(e(document).find("#user_name").val()),s=e.trim(e(document).find("#sec_key").val()),n=e.trim(e(document).find("#media-search-input").val());console.log(i+"___"+s);var d=e(".render-cushy-list");e(".pre-loader").css({width:d.width()+"px"}),""!==i&&""!==s?e.ajax({method:"POST",url:a+"/api/v1/get_user_feeds",data:{user_name:i,security_key:s,page:t,search_key:n},beforeSend:function(){e(".pre-loader").show()},dataType:"jsonp",success:function(t){if(c=!1,e(".pre-loader").hide(),e("button#loadMoreBtn").text("Load more"),void 0!==t.success&&1==t.success){if(void 0!==t.data.records&&t.data.records.length>0){var i="";if(n.length>0&&e(".render-cushy-list").html(""),e.each(t.data.records,function(e,a){i='<li tabindex="0" role="checkbox" aria-label="'+e+'" data-id="'+a.cushy_id+'" class="attachment save-ready select-item is-def-ite"><div class="attachment-preview js--select-attachment type-image subtype-png landscape"><div class="thumbnail" rel="'+a.cushy_id+'"><div class="centered"><img src="'+t.data.image_path+"/medium/"+a.media_name+'" draggable="false" alt="'+a.media_name+'"></div></div></div><button type="button" class="button-link check" tabindex="0"><span class="media-modal-icon"></span><span class="screen-reader-text">Deselect</span></button><input type="hidden" id="cushy_id'+a.cushy_id+'" name="cushy_id[]" value="'+a.cushy_id+'"><input type="hidden" id="cushy_media'+a.cushy_id+'" name="cushy_media[]" value="'+t.data.image_path+"/large/"+a.media_name+'"><input type="hidden" id="cushy_desc'+a.cushy_id+'" name="cushy_desc[]" value="'+a.description+'"><input type="hidden" id="cushy_loc'+a.cushy_id+'" name="cushy_loc[]" value="'+a.location_name+'"></li>',d.append(i)}),void 0!==t.data.next&&t.data.next>0){var a='<li class="btn-load-wrap"><button type="button" id="loadMoreBtn" class="btn btn-md btn-core-btn">Load more</button></li>';d.append(a)}}}else void 0!==t.message&&""!==t.message?d.html('<li class="error-holder">'+t.message+"</li>"):d.html('<li class="error-holder">Oops!!! No record</li>')},error:function(){console.log("Error")}}):console.log("Cushy credentials are missing")}},1e3)},e("#add-cushy-button").on("click",function(){d=1,o=[],r="",e.fn.fetchCushyList(d)}),s.on("keyup click","#media-search-input",function(t){var i=e.trim(e(this).val());clearTimeout(e.data(this,"timer")),d=1,"keyup"==t.type&&i.length>2?e.fn.fetchCushyList(d):("click"==t.type&&0===i||0===i)&&e(this).data("timer",setTimeout(function(){e.fn.fetchCushyList(d)},500))}),s.on("click","button#loadMoreBtn",function(t){e(this).attr("disabled",!0).text("Loading..."),d++,e(".btn-load-wrap").fadeOut(),e.fn.fetchCushyList(d)});var l=!1,r="";s.on("click","li.select-item",function(t){l=t.ctrlKey||t.metaKey?!0:!1;var i=e(this).attr("data-id"),a=e.inArray(i,o);a>=0?o.splice(a,1):5===o.length?alert("You can select upto 5 Cushy's"):o.push(i),s.find("li.select-item").removeClass("selected details"),o.length>0&&e.each(o,function(t,i){e("[data-id='"+i+"']").addClass("selected")}),e(this).addClass("details");var n=o.length;if(n>0){var d=e(this).find(".thumbnail").attr("src"),d=e("#cushy_media"+i).val(),c=e("#cushy_desc"+i).val(),r=e("#cushy_loc"+i).val();s.find(".cushy-overview").show(),s.find(".attachment-info .thumbnail-image img").attr("src",d),e("input.cushy-media").val(d),e("textarea.cushy-caption").val(c),e("input.cushy-loc").val(r),s.find(".return-btn").is(":visible")||e(".media-selection").show(),e(".media-selection").find(".count").text(n+" selected"),s.find(".media-button-insert").attr("disabled",!1)}else e(".media-selection").hide(),s.find(".media-button-insert").attr("disabled",!0)}),s.on("click",".edit-selection",function(){s.find(".select-item").not(".selected").hide(),e(".media-selection").hide(),s.find(".return-btn").show()}),s.on("click",".clear-selection",function(){o=[],s.find(".select-item").removeClass("selected details"),s.find(".media-button-insert").attr("disabled",!0),e(".media-selection, .cushy-overview").hide()}),s.on("click",".return-btn",function(){e(this).hide(),s.find(".select-item, .media-selection").show()}),e(document).on("click",".thumbnail",function(){e("body").removeClass("active-cushy"),e(this).addClass("active-cushy")}),e(document).on("click",".media-button-insert",function(){return o.length>0?(e(this).attr("disabled",!1),e.each(o,function(t,i){r+='[cushyview caption="'+e("#cushy_desc"+i).val()+'" id="'+i+'"]\n'}),wp.media.editor.insert(r),o=[],void 0):(e(this).attr("disabled",!0),!1)}),e(document).on("click",".media-modal-close",function(){d=1,o=[],r="",s.find(".select-item").removeClass("selected details"),s.find("#TB_window").fadeOut(),s.find("#TB_overlay").css({background:"transparent",opacity:1})})});